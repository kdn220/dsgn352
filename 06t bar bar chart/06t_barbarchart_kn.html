<!-- TODO: x axis
TODO: value labels
TODO: x and y axis labels
TODO: titles
TODO: other data -->

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>d3 bar chart</title>
          <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
          <style>
            p {
              font: 10px Garamond
            }
            body {
              background-color: #eee;
            }
            h1 {
              font: 20px Garamond
            }
            svg {
              background-color: white;
            }
            .axis path,
            .axis line {
              fill: none;
              stroke: #000;
              shape-rendering: crispEdges;
            }

            .axis path, {
              display: none;
            }

            .x_label {
                font-family: "Arial", sans-serif;

            .y_label {

            }
            }

          </style>
    </head>
    <h1>Bars of Boston</h1>
    <body>
        <script type="text/javascript">

//width / height
            var width = 600;
            var height = 250;
            var padding = 30;
            var dataset;
            // why create var dataset here?
            // SRB: it's a global variable and therefore can be accessed from within any function.

// CSV data
          d3.csv ( "bars.csv", function ( error, data ) {

                if ( error ) {
                    console.log ( "There was an error." ) ;
                } else {
                    dataset = data ;
                    barviz () ;
                }
            }) ;

// bind data to bars
    function barviz ( ) {
        var scale_multiplier = 20;
        var bar_padding = .5;
        var text_padding = 10;

        //x scale functions
        var xScale = d3.scale.ordinal()
                .domain(d3.range(dataset.length))
            // SRB: the line below was edited.
                .rangeRoundBands([0, width], 0.05);

        var yScale = d3.scale.linear()

                .domain([0, d3.max(dataset, function (data) {
                    return data[1];
                })])
                // KN - Is the above correct? Or can I make it static since I know the ratings will always be out of 10?
                // .domain([0,10])
                .range([0, 10]);

        var svg = d3.select("body")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

        //d3 bars
        var bar =
                d3.select("svg")
                        .selectAll("rect")
                        .data(dataset)
                        .enter()
                        .append("rect")
                        .attr("class", "bar")
                        .style("height", function (data) {
                            // console.log ( data ) ;
                            return data.Rating * scale_multiplier;
                        })
                        .style("width", function () {
                            return ( width / dataset.length ) - bar_padding;
                        })
                        .attr("fill", "purple")// FIXME: change to something else
                        .attr("x", function (data, index) {
                            return index * (width / dataset.length );
                        })
                        .attr("y", function (data) {
                            return height - (data.Rating * scale_multiplier);
                        });

        //text lb
        svg.selectAll("text")
                .data(dataset)
                .enter()
                .append("text")
                .text(function (data) {
                    return data.Rating
                })
                .attr("fill", "white")
                .attr("font-family", "sans-serif")
                .attr("font-size", "6px")
                .attr("x", function (data, index) {
                    return index * (width / dataset.length) + text_padding;
                })
                .attr("y", function (data) {
                    return height - (data.Rating * scale_multiplier) + text_padding;
                })
                .attr("text-anchor", "middle");

        //bar name lables
        // svg.select("text")
        //         .data(dataset)
        //         .append("text")
        //         .text(function (data) {
        //             return data.Bar
        //         })
        //         .attr("fill","black")
        //         .attr("font-family","sans-serif")
        //         .attr("font-size","10px")
        //         .attr("transform","rotate(45)")
        //x axis
        var xAxis = d3.svg.axis()
                .scale(xScale)
                .orient("bottom") ;

        svg.append("g")
                .attr("class", "axis")
                .attr("transform","translate(0,"+ (height-padding)+")")
                .call(xAxis);


        // SRB: the curly brace below was not in the correct place, and therefore the axis was not showing up.
    }
        //y axis

        var yAxis = d3.svg.axis()
                .scale(yScale)
                .orient("left")
                .ticks(10);

        svg.append("g")
                .attr("class","axis")
                .attr("transform","translate("+ padding + ",0)")
                .call(yAxis);

        </script>
    </body>
</html>
